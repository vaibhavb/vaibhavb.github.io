<html>

<head>
   <style media="screen" type="text/css">
  h1 {
	  color: red;
	  background-color: blue;
  	}

	#sidebar {
	  position: absolute;
	  left: 10px;
    	  top: 70px;
	  bottom: 20px;
	  width: 260px;
	  border: solid 1px #CCCCCC;
	  overflow-y: scroll;
	 }

	#container {
	  color: navy;
	}
   </style>
</head>

<body>
	<div id="sidebar"> </div>
	<div id="container">Loading..</div>

	<div>
		<h1>Vaibhav - Poems </h1>
	</div>

<!-- Templates -->
  <script type="text/template" id="poem-template-list">
      <a href='#posts/<%= id %>'><%= title%></a>
  </script>

  <script type="text/template" id="poem-template-details">
     <div class="poem-img">
	<textarea id="content" name="content"><%- content%></textarea>
     </div>
     <div class="poem-text">
	<img height="300" src="<%= picture %>" />
     </div>
  </script>

  <!-- ========= -->
  <!-- Libraries -->
  <!-- ========= -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>  
  
  <!-- =============== -->
  <!-- Javascript code -->
  <!-- =============== -->
  <script type="text/javascript">
    'use strict';

    var app = {};

    // models
    app.Poem = Backbone.Model.extend();

    //collections
    app.Poems = Backbone.Collection.extend({
	model: app.Poem,
	url: "http://ramblings.vitraag.com/api/get_category_posts/?dev=1&slug=writings",
	sync: function(method, model, options){  
    		options.dataType = "jsonp";  
		return Backbone.sync(method, model, options);  
  	}	
    });

    app.poems = new app.Poems();

    //views
    app.PoemListView = Backbone.View.extend({
      tagName:'ul',
      initialize:function () {
        this.model.bind("reset", this.render, this);
      },
      render:function (eventName) {
        _.each(this.model.models, function (poem) {
            $(this.el).append(new PoemView({model:poem}).render().el);
        }, this);
        return this;
      }
    });


    app.PoemView = Backbone.View.extend({
	tagName: "li",
	template: _.template($('#poem-template-list').html()),
	render: function(eventName) {
	  this.$el.html(this.template(this.model.toJSON()));
	  return this;
	},
    });

    //full application view
    app.AppView = Backbone.View.extend({
        template:_.template($('#poem-template-details').html()),
        render:function (eventName) {
           $(this.el).html(this.template(this.model.toJSON()));
           return this;
        }
    });

    // Router
    app.AppRouter = Backbone.Router.extend({
       routes:{
   	 "":"list",
         "posts/:id":"poemDetails"
       },
    list:function () {
        this.poemList = new app.Poems();
        this.poemListView = new app.PoemListView({model:this.poemList});
        this.poemList.fetch();
       	$('#sidebar').html(this.poemListView.render().el);
    },

    poemDetails:function (id) {
        this.poem = this.poemList.get(id);
        this.wineView = new app.PoemView({model:this.poem});
        $('#content').html(this.poemView.render().el);
    }
});

         
    //initializers
    app.appRouter = new app.AppRouter();
    Backbone.history.start();
  </script>


</body>

</html>
